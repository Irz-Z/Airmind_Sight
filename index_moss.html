{% extends 'base.html' %}

{% block header %}
  <style>
    /* Air Quality Colors */
    .air-quality-good { background: linear-gradient(135deg, #4ade80, #22c55e); color: white; } /* Green */
    .air-quality-moderate { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; } /* Yellow */
    .air-quality-unhealthy-sensitive { background: linear-gradient(135deg, #f87171, #ef4444); color: white; } /* Orange/Red for sensitive groups */
    .air-quality-unhealthy { background: linear-gradient(135deg, #a78bfa, #8b5cf6); color: white; } /* Purple */
    .air-quality-very-unhealthy { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; } /* Dark Red */
    .air-quality-hazardous { background: linear-gradient(135deg, #881337, #4c0519); color: white; } /* Darker Red/Brown */

    .loading-spinner { 
      border: 2px solid #f3f3f3; 
      border-top: 2px solid #3498db; 
      border-radius: 50%; 
      width: 20px; 
      height: 20px; 
      animation: spin 1s linear infinite; 
    }
    
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }

    .card-hover { 
      transition: all 0.3s ease; 
    }
    
    .card-hover:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Search bar section with background similar to homepage -->
  <div class="relative w-full h-auto flex flex-col text-black p-15 bg-white-500 bg-[url({{url_for('static',filename='img/sunny.jpg')}})] bg-blend-lighten bg-center bg-cover py-20">
    <div class="flex justify-center items-center mb-4">
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-4xl w-full mx-4">
        <h1 class="text-4xl font-[Gabarito] font-bold text-center mb-2">Area Recommendation</h1>
        <p class="text-center text-gray-600 mb-6 font-[Gabarito]">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏° ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</p>
        
        <!-- Search Form -->
        <form method="POST" class="flex flex-col gap-4">
          <!-- Hidden inputs for Time Series settings -->
          <input type="hidden" name="time_mode" value="forecast" />
          <input type="hidden" name="time_interval" value="daily" />
          <div class="flex flex-col sm:flex-row items-end gap-4">
            <div class="flex-1 w-full">
              <label for="province" class="block text-sm font-medium text-gray-700 mb-2 font-[Gabarito]">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
              <input 
                name="province" 
                id="province"
                value="{{ province }}" 
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà, ‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä, ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï, ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£..." 
                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-[Gabarito]"
                required
              />
            </div>
            <div class="w-full sm:w-auto">
              <label for="sort_by_dust" class="block text-sm font-medium text-gray-700 mb-2 font-[Gabarito]">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô</label>
              <select 
                name="sort_by_dust" 
                id="sort_by_dust"
                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-[Gabarito]"
              >
                <option value="aqius" {% if sort_by_dust == 'aqius' %}selected{% endif %}>AQI (US)</option>
                <option value="pm25" {% if sort_by_dust == 'pm25' %}selected{% endif %}>PM2.5</option>
                <option value="pm10" {% if sort_by_dust == 'pm10' %}selected{% endif %}>PM10</option>
              </select>
            </div>
            <div class="w-full sm:w-auto">
              <button 
                type="submit" 
                class="w-full sm:w-auto bg-blue-600 text-white px-8 py-3 rounded-xl hover:bg-blue-700 transition-colors duration-200 font-medium shadow-md hover:shadow-lg font-[Gabarito]"
              >
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
              </button>
            </div>
          </div>
          
          <!-- Time Series Options -->
          <div class="border-t pt-4 mt-4">
            <div class="flex flex-col sm:flex-row items-end gap-4">
              <div class="flex items-center">
                <input 
                  type="checkbox" 
                  name="enable_time_series" 
                  id="enable_time_series"
                  value="true"
                  {% if enable_time_series %}checked{% endif %}
                  class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                  onchange="toggleTimeSeriesOptions()"
                />
                <label for="enable_time_series" class="text-sm font-medium text-gray-700 font-[Gabarito]">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Time Series</label>
              </div>
              
              <div id="timeSeriesOptions" class="flex flex-col sm:flex-row gap-4 {% if not enable_time_series %}hidden{% endif %}">
                <div>
                  <label for="forecast_days" class="block text-sm font-medium text-gray-700 mb-1 font-[Gabarito]">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</label>
                  <select 
                    name="forecast_days" 
                    id="forecast_days"
                    class="px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-[Gabarito]"
                  >
                    <option value="3" {% if forecast_days == '3' %}selected{% endif %}>3 ‡∏ß‡∏±‡∏ô</option>
                    <option value="5" {% if forecast_days == '5' %}selected{% endif %}>5 ‡∏ß‡∏±‡∏ô</option>
                    <option value="7" {% if forecast_days == '7' %}selected{% endif %}>7 ‡∏ß‡∏±‡∏ô</option>
                  </select>
                </div>
              </div>
          </div>
        </div>
      </form>
      </div>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="max-w-6xl mx-auto px-4 pb-8">
    <!-- Error Message -->
    {% if error_message %}
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-8 rounded-xl shadow-md">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="font-medium font-[Gabarito]">{{ error_message }}</p>
        </div>
      </div>
    </div>
    {% endif %}


    <!-- Time Series Analysis Results -->
    {% if results.time_series and results.time_series.enabled %}
    <div class="mb-8">
      {% if results.time_series.error %}
      <div class="bg-red-50 border border-red-200 rounded-xl p-6 shadow-md">
        <h3 class="text-xl font-bold text-red-800 mb-2 font-[Gabarito]">Time Series Analysis Error</h3>
        <p class="text-red-700 font-[Gabarito]">{{ results.time_series.error }}</p>
      </div>
      {% elif results.time_series.analysis %}
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Time Series
          {% if results.time_series.mode == 'forecast' %}
          <span class="ml-2 bg-purple-100 text-purple-800 text-sm px-2 py-1 rounded-full">
            üîÆ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå {{ results.time_series.forecast_days }} ‡∏ß‡∏±‡∏ô
          </span>
          {% else %}
          <span class="ml-2 bg-purple-100 text-purple-800 text-sm px-2 py-1 rounded-full">
            {{ results.time_series.start_date }} ‡∏ñ‡∏∂‡∏á {{ results.time_series.end_date }}
          </span>
          {% endif %}
        </h3>
        
        {% set analysis = results.time_series.analysis %}
        {% if analysis.rankings %}
        {% if results.time_series.mode == 'forecast' %}
        <div class="mb-4 bg-amber-50 border border-amber-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-amber-600 mr-2">üîÆ</div>
            <p class="text-amber-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏® - ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            </p>
          </div>
        </div>
        {% elif results.time_series.mode == 'historical' %}
        <div class="mb-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-blue-600 mr-2">üìä</div>
            <p class="text-blue-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á - ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ 
              {% if results.time_series.real_data_count %}
              (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á: {{ results.time_series.real_data_count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
              {% endif %}
            </p>
          </div>
        </div>
        {% else %}
        <div class="mb-4 bg-green-50 border border-green-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-green-600 mr-2">‚úÖ</div>
            <p class="text-green-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏™‡∏° - ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </p>
          </div>
        </div>
        {% endif %}
        
        <div class="mb-6">
          {% set variance = ((analysis.worst_place.average - analysis.best_place.average) if (analysis.best_place and analysis.worst_place) else 0) %}
          {% set is_uniform_data = (variance < 10) %}
          {% set total_places = analysis.total_places or 1 %}
          
          {% if is_uniform_data or total_places == 1 %}
          <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
              <div class="text-blue-600 text-2xl mb-1">üìä</div>
              <p class="text-sm text-blue-600 font-medium">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</p>
              <p class="text-blue-800 font-bold">{{ province }}</p>
              {% if analysis.best_place %}
              <p class="text-blue-700 text-sm">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.best_place.average }}</p>
              {% endif %}
            </div>
            
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center">
              <div class="text-gray-600 text-2xl mb-1">üìà</div>
              <p class="text-sm text-gray-600 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
              <p class="text-gray-800 font-bold">{{ total_places }}</p>
              {% if results.time_series.mode == 'forecast' %}
              <p class="text-gray-700 text-sm">‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå: {{ results.time_series.forecast_days }} ‡∏ß‡∏±‡∏ô</p>
              {% else %}
              <p class="text-gray-700 text-sm">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: {{ results.time_series.interval }}</p>
              {% endif %}
            </div>
          </div>
          
          {% if total_places == 1 %}
          <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
            <div class="flex items-center">
              <div class="text-amber-600 mr-2">‚ÑπÔ∏è</div>
              <p class="text-amber-800 text-sm font-medium">
                ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ ‡∏à‡∏∂‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
              </p>
            </div>
          </div>
          {% else %}
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
            <div class="flex items-center">
              <div class="text-blue-600 mr-2">üìä</div>
              <p class="text-blue-800 text-sm font-medium">
                ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô
              </p>
            </div>
          </div>
          {% endif %}
          
          {% else %}
          <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
              <div class="text-green-600 text-2xl mb-1">üèÜ</div>
              <p class="text-sm text-green-600 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
              <p class="text-green-800 font-bold">{{ analysis.best_place.name if analysis.best_place else '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</p>
              {% if analysis.best_place %}
              <p class="text-green-700 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.best_place.average }}</p>
              {% endif %}
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
              <div class="text-blue-600 text-2xl mb-1">üìà</div>
              <p class="text-sm text-blue-600 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
              <p class="text-blue-800 font-bold">{{ total_places }}</p>
              {% if results.time_series.mode == 'forecast' %}
              <p class="text-blue-700 text-sm">‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå: {{ results.time_series.forecast_days }} ‡∏ß‡∏±‡∏ô</p>
              {% else %}
              <p class="text-blue-700 text-sm">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: {{ results.time_series.interval }}</p>
              {% endif %}
            </div>
            
            {% if analysis.worst_place and analysis.worst_place.average > analysis.best_place.average + 20 %}
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
              <div class="text-orange-600 text-2xl mb-1">‚ö†Ô∏è</div>
              <p class="text-sm text-orange-600 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤</p>
              <p class="text-orange-800 font-bold">{{ analysis.worst_place.name }}</p>
              <p class="text-orange-700 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.worst_place.average }}</p>
            </div>
            {% elif analysis.worst_place and analysis.worst_place.average > 150 %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
              <div class="text-yellow-600 text-2xl mb-1">‚ö†Ô∏è</div>
              <p class="text-sm text-yellow-600 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏™‡πà‡πÉ‡∏à</p>
              <p class="text-yellow-800 font-bold">{{ analysis.worst_place.name }}</p>
              <p class="text-yellow-700 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.worst_place.average }}</p>
            </div>
            {% endif %}
          </div>
          
          {% if variance > 10 and variance <= 30 %}
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
            <div class="flex items-center">
              <div class="text-blue-600 mr-2">üìä</div>
              <p class="text-blue-800 text-sm font-medium">
                ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡πÜ
              </p>
            </div>
          </div>
          {% elif variance > 30 %}
          <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
            <div class="flex items-center">
              <div class="text-amber-600 mr-2">üèûÔ∏è</div>
              <p class="text-amber-800 text-sm font-medium">
                ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
              </p>
            </div>
          </div>
          {% endif %}
          {% endif %}
          
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {% for place in analysis.rankings %}
          <div class="bg-gray-50 rounded-lg p-4 border">
            <div class="flex items-center justify-between mb-2">
              <h4 class="font-semibold text-gray-800">
                {{ place.medal }} {{ place.rank }}. {{ place.name }}
              </h4>
              <span class="text-sm text-gray-600">{{ place.city }}</span>
            </div>
            
            <div class="grid grid-cols-3 gap-4 text-sm">
              <div class="text-center">
                <p class="text-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                <p class="font-bold text-blue-600">{{ place.average }}</p>
              </div>
              <div class="text-center">
                <p class="text-gray-600">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</p>
                <p class="font-bold text-green-600">{{ place.minimum }}</p>
              </div>
              <div class="text-center">
                <p class="text-gray-600">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                <p class="font-bold text-red-600">{{ place.maximum }}</p>
              </div>
            </div>
            
            <div class="mt-2 text-xs text-gray-500">
              ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {{ place.data_points }} ‡∏à‡∏∏‡∏î
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Tourism Places with Air Quality -->
    {% if results.tourism %}
    <div class="mb-8">
      <h3 class="text-2xl font-[Gabarito] font-bold text-gray-800 mb-6 flex items-center">
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß (‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏î/‡∏®‡∏≤‡∏™‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤)
        <span class="ml-3 bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full font-[Gabarito]">{{ results.tourism|length }}</span>
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for place in results.tourism %}
        <div class="bg-white rounded-xl shadow-2xl card-hover overflow-hidden border border-gray-100">
          <div class="p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-3 font-[Gabarito]">{{ place.name or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</h4>
            
            <!-- Air Quality Badge -->
            {% if place.air_quality %}
            <div class="mb-4 flex flex-wrap gap-2">
              {% set aqi = place.air_quality.aqi %}
              {% set pm25 = place.air_quality.pm25 %}
              {% set pm10 = place.air_quality.pm10 %}
              
              {% set aqi_level_class = 'air-quality-good' %}
              {% set aqi_level_icon = 'GREEN' %}

              {% if aqi > 200 %}
                {% set aqi_level_class = 'air-quality-hazardous' %}
                {% set aqi_level_icon = 'BLACK' %}
              {% elif aqi > 150 %}
                {% set aqi_level_class = 'air-quality-unhealthy' %}
                {% set aqi_level_icon = 'RED' %}
              {% elif aqi > 100 %}
                {% set aqi_level_class = 'air-quality-unhealthy-sensitive' %}
                {% set aqi_level_icon = 'ORANGE' %}
              {% elif aqi > 50 %}
                {% set aqi_level_class = 'air-quality-moderate' %}
                {% set aqi_level_icon = 'YELLOW' %}
              {% endif %}

              {# ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Python ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô template #}
              {% set rank_text = place.rank_text or '' %}
              {% set medal = place.medal or '' %}

              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {{ aqi_level_class }} font-[Gabarito]">
                {% if sort_by_dust == 'aqius' %}
                  {{ aqi_level_icon }} AQI: {{ aqi if aqi is not none else '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm25' %}
                  {{ aqi_level_icon }} PM2.5: {{ pm25 if pm25 is not none else '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm10' %}
                  {{ aqi_level_icon }} PM10: {{ pm10 if pm10 is not none else '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% endif %}
                {% if sort_by_dust == 'aqius' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              {% if pm25 is not none %}
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 font-[Gabarito]">
                PM2.5: {{ pm25 }}
                {% if sort_by_dust == 'pm25' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              {% else %}
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500 font-[Gabarito]">
                PM2.5: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏
              </span>
              {% endif %}
              {% if pm10 is not none %}
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 font-[Gabarito]">
                PM10: {{ pm10 }}
                {% if sort_by_dust == 'pm10' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              {% else %}
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500 font-[Gabarito]">
                PM10: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏
              </span>
              {% endif %}
            </div>
            {% endif %}
            
            <!-- Time Series Statistics (if available) -->
            {% if place.time_series_stats %}
            <div class="mb-4 bg-purple-50 border border-purple-200 rounded-lg p-3">
              <h5 class="text-sm font-semibold text-purple-800 mb-2 font-[Gabarito]">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Time Series</h5>
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div class="text-purple-700">
                  <span class="font-medium">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</span> {{ place.time_series_stats.average }}
                </div>
                <div class="text-purple-700">
                  <span class="font-medium">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span> {{ place.time_series_stats.data_points }} ‡∏à‡∏∏‡∏î
                </div>
                <div class="text-purple-700">
                  <span class="font-medium">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î:</span> {{ place.time_series_stats.minimum }}
                </div>
                <div class="text-purple-700">
                  <span class="font-medium">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</span> {{ place.time_series_stats.maximum }}
                </div>
              </div>
              {% if place.time_series_stats.medal %}
              <div class="mt-2 text-center">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  üèÜ {{ place.time_series_stats.medal }}
                </span>
              </div>
              {% endif %}
            </div>
            {% endif %}
            
            <div class="space-y-2 text-sm text-gray-600">
              <p class="flex items-start">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span>
                <span class="font-[Gabarito]">{{ place.full_address or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏û‡∏¥‡∏Å‡∏±‡∏î:</span>
                <span class="font-[Gabarito]">{{ "%.4f"|format(place.lat) }}, {{ "%.4f"|format(place.lon) }}</span>
              </p>
              
              {% if place.type %}
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span>
                <span class="font-[Gabarito]">{{ place.type or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              {% else %}
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span>
                <span class="font-[Gabarito]">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span>
              </p>
              {% endif %}
            </div>
            
            <div class="mt-4 flex gap-2">
              <a 
                href="https://maps.google.com/?q={{ place.lat }},{{ place.lon }}" 
                target="_blank" 
                class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-xl hover:bg-blue-700 transition-colors font-[Gabarito] shadow-md hover:shadow-lg"
              >
                ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
              </a>
              
              {% if place.air_quality %}
              {% set air_city = place.air_quality.city or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_aqi = place.air_quality.aqi or 0 %}
              {% set air_desc = place.air_quality.description or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_pm25 = place.air_quality.pm25 or 0 %}
              {% set air_pm10 = place.air_quality.pm10 or 0 %}
              <button 
                class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm rounded-xl hover:bg-green-700 transition-colors air-quality-btn font-[Gabarito] shadow-md hover:shadow-lg"
                data-city="{{ air_city }}"
                data-aqi="{{ air_aqi }}"
                data-description="{{ air_desc }}"
                data-pm25="{{ air_pm25 }}"
                data-pm10="{{ air_pm10 }}"
              >
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
              </button>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Time Series Analysis Results -->
    {% if results.time_series and results.time_series.enabled %}
    <div class="mb-8">
      {% if results.time_series.error %}
      <div class="bg-red-50 border border-red-200 rounded-xl p-6 shadow-md">
        <h3 class="text-xl font-bold text-red-800 mb-2 font-[Gabarito]">Time Series Analysis Error</h3>
        <p class="text-red-700 font-[Gabarito]">{{ results.time_series.error }}</p>
      </div>
      {% elif results.time_series.analysis %}
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Time Series
          {% if results.time_series.mode == 'forecast' %}
          <span class="ml-2 bg-purple-100 text-purple-800 text-sm px-2 py-1 rounded-full">
            üîÆ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå {{ results.time_series.forecast_days }} ‡∏ß‡∏±‡∏ô
          </span>
          {% else %}
          <span class="ml-2 bg-purple-100 text-purple-800 text-sm px-2 py-1 rounded-full">
            {{ results.time_series.start_date }} ‡∏ñ‡∏∂‡∏á {{ results.time_series.end_date }}
          </span>
          {% endif %}
        </h3>
        
        {% set analysis = results.time_series.analysis %}
        {% if analysis.rankings %}
        {% if results.time_series.mode == 'forecast' %}
        <div class="mb-4 bg-amber-50 border border-amber-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-amber-600 mr-2">üîÆ</div>
            <p class="text-amber-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏® - ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            </p>
          </div>
        </div>
        {% elif results.time_series.mode == 'historical' %}
        <div class="mb-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-blue-600 mr-2">üìä</div>
            <p class="text-blue-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á - ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ 
              {% if results.time_series.real_data_count %}
              (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á: {{ results.time_series.real_data_count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
              {% endif %}
            </p>
          </div>
        </div>
        {% else %}
        <div class="mb-4 bg-green-50 border border-green-200 rounded-lg p-3">
          <div class="flex items-center">
            <div class="text-green-600 mr-2">‚úÖ</div>
            <p class="text-green-800 text-sm font-medium">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏™‡∏° - ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </p>
          </div>
        </div>
        {% endif %}
        
        <div class="mb-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
              <div class="text-green-600 text-2xl mb-1">üèÜ</div>
              <p class="text-sm text-green-600 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
              <p class="text-green-800 font-bold">{{ analysis.best_place.name if analysis.best_place else '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</p>
              {% if analysis.best_place %}
              <p class="text-green-700 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.best_place.average }}</p>
              {% endif %}
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
              <div class="text-blue-600 text-2xl mb-1">üìà</div>
              <p class="text-sm text-blue-600 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
              <p class="text-blue-800 font-bold">{{ analysis.total_places }}</p>
              {% if results.time_series.mode == 'forecast' %}
              <p class="text-blue-700 text-sm">‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå: {{ results.time_series.forecast_days }} ‡∏ß‡∏±‡∏ô</p>
              {% else %}
              <p class="text-blue-700 text-sm">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: {{ results.time_series.interval }}</p>
              {% endif %}
            </div>
            
            {% if analysis.worst_place and analysis.worst_place.average > 100 %}
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
              <div class="text-red-600 text-2xl mb-1">‚ö†Ô∏è</div>
              <p class="text-sm text-red-600 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</p>
              <p class="text-red-800 font-bold">{{ analysis.worst_place.name }}</p>
              <p class="text-red-700 text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {{ analysis.worst_place.average }}</p>
            </div>
            {% endif %}
          </div>
          
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {% for place in analysis.rankings %}
          <div class="bg-gray-50 rounded-lg p-4 border">
            <div class="flex items-center justify-between mb-2">
              <h4 class="font-semibold text-gray-800">
                {{ place.medal }} {{ place.rank }}. {{ place.name }}
              </h4>
              <span class="text-sm text-gray-600">{{ place.city }}</span>
            </div>
            
            <div class="grid grid-cols-3 gap-4 text-sm">
              <div class="text-center">
                <p class="text-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                <p class="font-bold text-blue-600">{{ place.average }}</p>
              </div>
              <div class="text-center">
                <p class="text-gray-600">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</p>
                <p class="font-bold text-green-600">{{ place.minimum }}</p>
              </div>
              <div class="text-center">
                <p class="text-gray-600">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                <p class="font-bold text-red-600">{{ place.maximum }}</p>
              </div>
            </div>
            
            <div class="mt-2 text-xs text-gray-500">
              ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {{ place.data_points }} ‡∏à‡∏∏‡∏î
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Other Categories -->
    {# Hotels Section #}
    {% if results.hotels %}
    <div class="mb-8">
      <h3 class="text-2xl font-[Gabarito] font-bold text-gray-800 mb-6 flex items-center">
        üè® ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°
        <span class="ml-3 bg-purple-100 text-purple-800 text-sm px-3 py-1 rounded-full font-[Gabarito]">{{ results.hotels|length }}</span>
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for place in results.hotels %}
        <div class="bg-white rounded-xl shadow-2xl card-hover overflow-hidden border border-gray-100">
          <div class="p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-3 font-[Gabarito]">{{ place.name or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</h4>
            
            <!-- Air Quality Badge -->
            {% if place.air_quality %}
            <div class="mb-4 flex flex-wrap gap-2">
              {% set aqi = place.air_quality.aqi %}
              {% set pm25 = place.air_quality.pm25 %}
              {% set pm10 = place.air_quality.pm10 %}
              
              {% set aqi_level_class = 'air-quality-good' %}
              {% set aqi_level_icon = 'GREEN' %}

              {% if aqi > 200 %}
                {% set aqi_level_class = 'air-quality-hazardous' %}
                {% set aqi_level_icon = 'BLACK' %}
              {% elif aqi > 150 %}
                {% set aqi_level_class = 'air-quality-unhealthy' %}
                {% set aqi_level_icon = 'RED' %}
              {% elif aqi > 100 %}
                {% set aqi_level_class = 'air-quality-unhealthy-sensitive' %}
                {% set aqi_level_icon = 'ORANGE' %}
              {% elif aqi > 50 %}
                {% set aqi_level_class = 'air-quality-moderate' %}
                {% set aqi_level_icon = 'YELLOW' %}
              {% endif %}

              {# ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Python ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô template #}
              {% set rank_text = place.rank_text or '' %}
              {% set medal = place.medal or '' %}

              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {{ aqi_level_class }} font-[Gabarito]">
                {% if sort_by_dust == 'aqius' %}
                  {{ aqi_level_icon }} AQI: {{ aqi or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm25' %}
                  {{ aqi_level_icon }} PM2.5: {{ pm25 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm10' %}
                  {{ aqi_level_icon }} PM10: {{ pm10 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% endif %}
                {% if sort_by_dust == 'aqius' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 font-[Gabarito]">
                PM2.5: {{ pm25 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% if sort_by_dust == 'pm25' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 font-[Gabarito]">
                PM10: {{ pm10 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% if sort_by_dust == 'pm10' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
            </div>
            {% endif %}
            
            <div class="space-y-2 text-sm text-gray-600">
              <p class="flex items-start">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span>
                <span class="font-[Gabarito]">{{ place.full_address or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏û‡∏¥‡∏Å‡∏±‡∏î:</span>
                <span class="font-[Gabarito]">{{ "%.4f"|format(place.lat) }}, {{ "%.4f"|format(place.lon) }}</span>
              </p>
              
              {% if place.type %}
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span>
                <span class="font-[Gabarito]">{{ place.type or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              {% endif %}
            </div>
            
            <div class="mt-4 flex gap-2">
              <a 
                href="https://maps.google.com/?q={{ place.lat }},{{ place.lon }}" 
                target="_blank" 
                class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-xl hover:bg-blue-700 transition-colors font-[Gabarito] shadow-md hover:shadow-lg"
              >
                ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
              </a>
              
              {% if place.air_quality %}
              {% set air_city = place.air_quality.city or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_aqi = place.air_quality.aqi or 0 %}
              {% set air_desc = place.air_quality.description or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_pm25 = place.air_quality.pm25 or 0 %}
              {% set air_pm10 = place.air_quality.pm10 or 0 %}
              <button 
                class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm rounded-xl hover:bg-green-700 transition-colors air-quality-btn font-[Gabarito] shadow-md hover:shadow-lg"
                data-city="{{ air_city }}"
                data-aqi="{{ air_aqi }}"
                data-description="{{ air_desc }}"
                data-pm25="{{ air_pm25 }}"
                data-pm10="{{ air_pm10 }}"
              >
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
              </button>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {# Restaurants Section #}
    {% if results.restaurants %}
    <div class="mb-8">
      <h3 class="text-2xl font-[Gabarito] font-bold text-gray-800 mb-6 flex items-center">
        ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
        <span class="ml-3 bg-orange-100 text-orange-800 text-sm px-3 py-1 rounded-full font-[Gabarito]">{{ results.restaurants|length }}</span>
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {# ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Python ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô template #}
        {% for place in results.restaurants %}
        <div class="bg-white rounded-xl shadow-2xl card-hover overflow-hidden border border-gray-100">
          <div class="p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-3 font-[Gabarito]">{{ place.name or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</h4>
            
            <!-- Air Quality Badge -->
            {% if place.air_quality %}
            <div class="mb-4 flex flex-wrap gap-2">
              {% set aqi = place.air_quality.aqi %}
              {% set pm25 = place.air_quality.pm25 %}
              {% set pm10 = place.air_quality.pm10 %}
              
              {% set aqi_level_class = 'air-quality-good' %}
              {% set aqi_level_icon = 'GREEN' %}

              {% if aqi > 200 %}
                {% set aqi_level_class = 'air-quality-hazardous' %}
                {% set aqi_level_icon = 'BLACK' %}
              {% elif aqi > 150 %}
                {% set aqi_level_class = 'air-quality-unhealthy' %}
                {% set aqi_level_icon = 'RED' %}
              {% elif aqi > 100 %}
                {% set aqi_level_class = 'air-quality-unhealthy-sensitive' %}
                {% set aqi_level_icon = 'ORANGE' %}
              {% elif aqi > 50 %}
                {% set aqi_level_class = 'air-quality-moderate' %}
                {% set aqi_level_icon = 'YELLOW' %}
              {% endif %}

              {# ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Python ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô template #}
              {% set rank_text = place.rank_text or '' %}
              {% set medal = place.medal or '' %}

              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {{ aqi_level_class }} font-[Gabarito]">
                {% if sort_by_dust == 'aqius' %}
                  {{ aqi_level_icon }} AQI: {{ aqi or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm25' %}
                  {{ aqi_level_icon }} PM2.5: {{ pm25 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% elif sort_by_dust == 'pm10' %}
                  {{ aqi_level_icon }} PM10: {{ pm10 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% endif %}
                {% if sort_by_dust == 'aqius' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 font-[Gabarito]">
                PM2.5: {{ pm25 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% if sort_by_dust == 'pm25' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
              
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 font-[Gabarito]">
                PM10: {{ pm10 or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
                {% if sort_by_dust == 'pm10' and rank_text and rank_text != '-' %}<span class="ml-1">{{ medal }}{{ rank_text }}</span>{% endif %}
              </span>
            </div>
            {% endif %}
            
            <div class="space-y-2 text-sm text-gray-600">
              <p class="flex items-start">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span>
                <span class="font-[Gabarito]">{{ place.full_address or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏û‡∏¥‡∏Å‡∏±‡∏î:</span>
                <span class="font-[Gabarito]">{{ "%.4f"|format(place.lat) }}, {{ "%.4f"|format(place.lon) }}</span>
              </p>
              
              {% if place.type %}
              <p class="flex items-center">
                <span class="font-medium text-gray-800 mr-2 font-[Gabarito]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span>
                <span class="font-[Gabarito]">{{ place.type or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
              </p>
              {% endif %}
            </div>
            
            <div class="mt-4 flex gap-2">
              <a 
                href="https://maps.google.com/?q={{ place.lat }},{{ place.lon }}" 
                target="_blank" 
                class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-xl hover:bg-blue-700 transition-colors font-[Gabarito] shadow-md hover:shadow-lg"
              >
                ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
              </a>
              
              {% if place.air_quality %}
              {% set air_city = place.air_quality.city or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_aqi = place.air_quality.aqi or 0 %}
              {% set air_desc = place.air_quality.description or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %}
              {% set air_pm25 = place.air_quality.pm25 or 0 %}
              {% set air_pm10 = place.air_quality.pm10 or 0 %}
              <button 
                class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm rounded-xl hover:bg-green-700 transition-colors air-quality-btn font-[Gabarito] shadow-md hover:shadow-lg"
                data-city="{{ air_city }}"
                data-aqi="{{ air_aqi }}"
                data-description="{{ air_desc }}"
                data-pm25="{{ air_pm25 }}"
                data-pm10="{{ air_pm10 }}"
              >
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
              </button>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- No Results Message -->
    {% if province and not results.tourism and not results.hotels and not results.restaurants %}
    <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center shadow-md">
      <div class="text-yellow-600 text-6xl mb-4">!</div>
      <h3 class="text-xl font-semibold text-yellow-800 mb-2 font-[Gabarito]">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
      <p class="text-yellow-700 font-[Gabarito]">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î "{{ province }}"</p>
      <p class="text-yellow-600 text-sm mt-2 font-[Gabarito]">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥</p>
    </div>
    {% endif %}

    {% endif %}

    <!-- Popular Provinces -->
    {% if not province %}
    <div class="bg-white rounded-xl shadow-2xl p-8 card-hover">
      <h3 class="text-2xl font-bold text-gray-800 mb-6 font-[Gabarito] text-center">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% for prov in ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô"] %}
        <button 
          onclick="document.getElementById('province').value='{{ prov }}'; document.querySelector('form').submit();"
          class="bg-blue-50 hover:bg-blue-100 text-blue-700 font-medium py-3 px-4 rounded-xl transition-colors text-sm font-[Gabarito] shadow-md hover:shadow-lg transform hover:-translate-y-1"
        >
          {{ prov }}
        </button>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  </div>

  <!-- Air Quality Modal -->
  <div id="airQualityModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-semibold font-[Gabarito]">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</h3>
        <button onclick="closeAirQualityModal()" class="text-gray-500 hover:text-gray-700 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="airQualityContent">
        <!-- Content will be inserted here -->
      </div>
    </div>
  </div>

  <script>
    function toggleTimeSeriesOptions() {
      const checkbox = document.getElementById('enable_time_series');
      const options = document.getElementById('timeSeriesOptions');
      
      if (checkbox.checked) {
        options.classList.remove('hidden');
        // Set default dates if not already set
        const today = new Date().toISOString().split('T')[0];
        const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        
        if (!document.getElementById('start_date').value) {
          document.getElementById('start_date').value = weekAgo;
        }
        if (!document.getElementById('end_date').value) {
          document.getElementById('end_date').value = today;
        }
      } else {
        options.classList.add('hidden');
      }
    }
    
    function showAirQualityDetails(city, aqi, description, pm25, pm10) {
      let aqiLevelClass = 'air-quality-good';
      let aqiLevelIcon = 'üü¢';
      
      if (aqi > 200) {
        aqiLevelClass = 'air-quality-hazardous';
        aqiLevelIcon = '‚ö´';
      } else if (aqi > 150) {
        aqiLevelClass = 'air-quality-unhealthy';
        aqiLevelIcon = 'üî¥';
      } else if (aqi > 100) {
        aqiLevelClass = 'air-quality-unhealthy-sensitive';
        aqiLevelIcon = 'üü†';
      } else if (aqi > 50) {
        aqiLevelClass = 'air-quality-moderate';
        aqiLevelIcon = 'üü°';
      }
      
      const content = `
        <div class="space-y-4">
          <div class="text-center">
            <div class="text-4xl mb-2">${aqiLevelIcon}</div>
            <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium ${aqiLevelClass}">
              AQI: ${aqi}
            </div>
          </div>
          
          <div class="space-y-2">
            <p><strong>üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${city}</p>
            <p><strong>üìä ‡∏Ñ‡πà‡∏≤ AQI (US):</strong> ${aqi}</p>
            ${pm25 ? `<p><strong>üí® PM2.5:</strong> ${pm25}</p>` : ''}
            ${pm10 ? `<p><strong>üí® PM10:</strong> ${pm10}</p>` : ''}
            <p><strong>‚ÑπÔ∏è ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</strong> ${description}</p>
          </div>
          
          <div class="bg-gray-50 p-3 rounded-lg text-sm">
            <p class="font-medium mb-1">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</p>
            <p class="text-gray-700">${getHealthAdvice(aqi)}</p>
          </div>
        </div>
      `;
      
      document.getElementById('airQualityContent').innerHTML = content;
      document.getElementById('airQualityModal').classList.remove('hidden');
      document.getElementById('airQualityModal').classList.add('flex');
    }
    
    function closeAirQualityModal() {
      document.getElementById('airQualityModal').classList.add('hidden');
      document.getElementById('airQualityModal').classList.remove('flex');
    }
    
    function getHealthAdvice(aqi) {
      if (aqi <= 50) return '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó';
      if (aqi <= 100) return '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ô‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏°‡∏•‡∏û‡∏¥‡∏©‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢';
      if (aqi <= 150) return '‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏Ñ‡∏ô‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏°‡∏•‡∏û‡∏¥‡∏©‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏Å';
      if (aqi <= 200) return '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏î‡∏µ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á';
      return '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
    }
    
    // Close modal when clicking outside
    document.getElementById('airQualityModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeAirQualityModal();
      }
    });
    
    // Auto-focus on search input
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('province').focus();
      
      // Add event listeners for air quality buttons
      document.querySelectorAll('.air-quality-btn').forEach(button => {
        button.addEventListener('click', function() {
          const city = this.dataset.city || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
          const aqi = parseInt(this.dataset.aqi) || 0;
          const description = this.dataset.description || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
          const pm25 = parseInt(this.dataset.pm25) || 0;
          const pm10 = parseInt(this.dataset.pm10) || 0;
          
          showAirQualityDetails(city, aqi, description, pm25, pm10);
        });
      });
    });
  </script>

{% endblock %}