{% extends 'base.html' %}

{% block header %}
<script>
    // import value from flask
    const weatherData = JSON.parse("{{ weather|safe }}".replace(/'/g, '"'));
    const province = "{{ province }}";

    // once the page is loaded successfully
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelector('#location').innerHTML = `${weatherData.data.city}, Thailand`;
        document.querySelector('#weatherHead').innerHTML = weatherData.data.current.weather.tp;
        document.querySelector('#unit').innerHTML = "°C";
        document.querySelector('#humidity').innerHTML = `Humidity: ${weatherData.data.current.weather.hu}%`;
        document.querySelector('#pressure').innerHTML = `Pressure: ${weatherData.data.current.weather.pr} hPa`;
        document.querySelector('#windSpeed').innerHTML = `Wind Speed: ${weatherData.data.current.weather.ws} m/s`;
        document.querySelector('#windDirection').innerHTML = `Wind Direction: ${weatherData.data.current.weather.wd}°`;

        // get icon value from weatherData and get icon value from ic
        // and do the if-else condition for icon selection
        const weatherStatus = weatherData.data.current.weather.ic;
        const aqius = weatherData.data.current.pollution.aqius;
        var icon = document.querySelector('#icon');
        
        function defineIconSky() {
            switch (weatherStatus) {
                // for clear sky day
                case "01d":
                case "02d":
                    icon.src = "{{url_for('static', filename='weather/01d.png')}}";
                    break;
                // for clear sky night
                case "01n":
                case "02n":
                    icon.src = "{{url_for('static', filename='weather/01n.png')}}";
                    break;
                // for cloudy day
                case "02d":
                case "03d":
                case "04d":
                    icon.src = "{{url_for('static', filename='weather/0234d.png')}}";
                    break;
                // for cloudy night
                case "02n":
                case "03n":
                case "04n":
                    icon.src = "{{url_for('static', filename='weather/0234n.png')}}";
                    break;
                // for rainy day
                case "09d":
                case "10d":
                    icon.src = "{{url_for('static', filename='weather/910d.png')}}";
                    break;
                // for rainy night
                case "09n":
                case "10n":
                    icon.src = "{{url_for('static', filename='weather/910n.png')}}";
                    break;
                    // for thunderstorm
                case "11d":
                    icon.src = "{{url_for('static', filename='weather/11d.png')}}"
                    break;
            }
        }

        // define AQI icon from aqius value through aqi US system
        function defineIconAir() {
            switch (aqius) {
                case (aqius < 51):
                    // Good - Green
                    break;
                case (50 < aqius < 101 ):
                    // Moderate - Yellow
                    break;
                case (100 < aqius < 151):
                    // Unhealty for Sensitive Groups - Orange
                    break;
                case (150 < aqius < 201):
                    // Unhealty - Red
                    break;
                case (200 < aqius < 301):
                    // Very Unhealty - Purple
                    break;
                case (aqius > 300):
                    // Hazardous - Maroon
                    break;
            }
        }

        defineIconSky();

        // Add handlers for both buttons
        document.querySelector('#weatherBtn').onclick = function() {
            document.querySelector('#weatherHead').innerHTML = weatherData.data.current.weather.tp;
            document.querySelector('#unit').innerHTML = "°C";
            defineIconSky();
        }
        document.querySelector('#aqiBtn').onclick = function() {
            document.querySelector('#weatherHead').innerHTML = weatherData.data.current.pollution.aqius;
            document.querySelector('#unit').innerHTML = "AQI";
            defineIconAir();
    } 
    });
</script>
{% endblock %}

{% block content %}
    <!-- Search bar -->
    <div class="relative w-full h-full flex flex-col text-black p-15 bg-white-500 bg-[url({{url_for('static',filename='img/sunny.jpg')}})] bg-blend-lighten bg-center bg-cover">
        <div class="flex justify-center items-center mb-4">
            <form method="POST" class="flex p-4 items-center justify-center w-150 bg-white rounded-4xl">
                <input name="province" value="{{ province }}" placeholder="ใส่ชื่อสถานที่..." class="w-full"/>
                <button type="submit" class="w-20">ค้นหา</button>
            </form>
        </div>
        <!-- Weather | Air Quality Button -->
        <div class="text-bold text-xl font-[Gabarito] mb-4">
            <div class="text-bold text-xl font-[Gabarito] mb-4">
                <button id="weatherBtn" type="submit" name="page" class="font-bold hover:text-white duration-200">Weather</button> |
                <button id="aqiBtn" type="submit" name="page" class="hover:text-white duration-200">Air Quality</button>
            </div>
        </div>
        <!-- Weather Data -->
        <div class="flex w-auto">
            <div class="flex">
                <!-- Weather Status Icon -->
                <img id="icon" src="{{url_for('static',filename='img/sun.png')}}" alt="sunny" class="size-48 mb-4 p-5">
                <div class="flex flex-col">
                    <div id="location" class="font-[Gabarito] text-4xl font-bold">Province</div>
                    <div class="flex">
                        <div id="weatherHead" class="flex font-[Gabarito] text-6xl font-bold"></div>
                        <div id="unit" class="font-[Gabarito] text-xl font-thin">°C</div>
                    </div>
                    <div class="flex flex-col">
                        <div id="humidity" class="font-[Gabarito]">Humidity: N/A%</div>
                        <div id="pressure" class="font-[Gabarito]">Pressure: N/A hPa</div>
                        <div id="windSpeed" class="font-[Gabarito]">Wind Speed: N/A m/s</div>
                        <div id="windDirection" class="font-[Gabarito]">Wind Direction: N/A°</div>
                    </div>
                </div>
            </div>
            <!-- Datetime -->
            <div class="flex-col w-auto align-items-end ml-auto">
                <div id="day" class="font-[Gabarito] font-bold text-4xl">{{ datetime.day }}</div>
                <div id="date" class="font-[Gabarito] font-bold text-4xl">{{ datetime.date }} {{ datetime.month }} {{ datetime.year }}</div>
                <div id="currentTime" class="font-[Gabarito] font-bold text-4xl">{{ datetime.current_time }}</div>
            </div>
        </div>
    </div>
    <div class="flex mt-10 w-full justify-center items-center flex-wrap gap-5">
        <div class="flex-col w-full h-full justify-center items-center bg-white drop-shadow-2xl rounded-lg max-w-90 p-10
    hover:shadow-2xl hover:-translate-y-4 transform transition duration-200 ease-in-out">
            <img class="flex justify-center items-center" src="{{url_for('static', filename='img/neuron.png')}}" alt="Neuron Network">
            <h1 class="font-[Gabarito] text-2xl font-bold text-center">AI-Powered</h1>
            <p class="font-[Gabarito] text-center">Advanced machine learning algorithms analyze weather patterns and historical data</p>
        </div>
        <div class="flex-col w-full h-full justify-center items-center bg-white drop-shadow-2xl rounded-lg max-w-90 p-10
    hover:shadow-2xl hover:-translate-y-4 transform transition duration-200 ease-in-out">
            <img class="flex justify-center items-center p-10" src="{{url_for('static', filename='img/graph.png')}}" alt="Graph Forecast">
            <h1 class="font-[Gabarito] text-2xl font-bold text-center">Accurate Forecast</h1>
            <p class="font-[Gabarito] text-center">Get detailed PM2.5 predictions for the next 7 days to plan ahead <br>‎ </p>
        </div>
        <div class="flex-col w-full h-full justify-center items-center bg-white drop-shadow-2xl rounded-lg max-w-90 p-10
    hover:shadow-2xl hover:-translate-y-4 transform transition duration-200 ease-in-out">
            <img class="flex justify-center items-center p-10" src="{{url_for('static', filename='img/map.png')}}" alt="Place Recommendation">
            <h1 class="font-[Gabarito] text-2xl font-bold text-center">Place Recommendation</h1>
            <p class="font-[Gabarito] text-center">Advanced machine learning algorithms analyze weather patterns and historical data</p>
        </div>
    </div><br><br><br>
    
{% endblock %}